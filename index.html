<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus â€” Tijdbeheer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='14' fill='%23FEF2F2' stroke='%23DC2626' stroke-width='1.5'/><circle cx='16' cy='16' r='9' fill='none' stroke='%23DC2626' stroke-width='1.5' opacity='0.5'/><circle cx='16' cy='16' r='4' fill='%23DC2626'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #FAFAFA;
            --surface: #FFFFFF;
            --border: #E5E5E5;
            --border-hover: #D4D4D4;
            --text-primary: #171717;
            --text-secondary: #525252;
            --text-muted: #A3A3A3;
            --focus: #DC2626;
            --focus-light: #FEF2F2;
            --focus-ring: rgba(220, 38, 38, 0.15);
            --break: #059669;
            --break-light: #ECFDF5;
            --break-ring: rgba(5, 150, 105, 0.15);
            --long-break: #2563EB;
            --long-break-light: #EFF6FF;
            --long-break-ring: rgba(37, 99, 235, 0.15);
            --radius: 12px;
            --radius-sm: 8px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow: 0 4px 12px rgba(0,0,0,0.06);
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
        }

        .logo-text {
            font-size: 1.125rem;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .settings-btn {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .settings-btn:hover {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        .settings-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Main */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            gap: 2rem;
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 100px;
        }

        .mode-tab {
            padding: 0.625rem 1.25rem;
            border: none;
            background: transparent;
            border-radius: 100px;
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .mode-tab:hover {
            color: var(--text-primary);
        }

        .mode-tab.active {
            background: var(--text-primary);
            color: var(--surface);
        }

        /* Timer Card */
        .timer-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 3rem 4rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .timer-card[data-mode="focus"] {
            border-color: var(--focus);
            box-shadow: 0 0 0 4px var(--focus-ring), var(--shadow);
        }

        .timer-card[data-mode="break"] {
            border-color: var(--break);
            box-shadow: 0 0 0 4px var(--break-ring), var(--shadow);
        }

        .timer-card[data-mode="long-break"] {
            border-color: var(--long-break);
            box-shadow: 0 0 0 4px var(--long-break-ring), var(--shadow);
        }

        .timer-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            transition: var(--transition);
        }

        .timer-card[data-mode="focus"] .timer-label { color: var(--focus); }
        .timer-card[data-mode="break"] .timer-label { color: var(--break); }
        .timer-card[data-mode="long-break"] .timer-label { color: var(--long-break); }

        .timer-display {
            font-family: 'DM Mono', monospace;
            font-size: 6rem;
            font-weight: 500;
            line-height: 1;
            letter-spacing: -0.02em;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }

        @media (max-width: 480px) {
            .timer-display {
                font-size: 4rem;
            }
            .timer-card {
                padding: 2rem 2.5rem;
            }
        }

        .timer-controls {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 100px;
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        .btn-primary {
            background: var(--text-primary);
            color: var(--surface);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        /* Progress */
        .progress-section {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .progress-dots {
            display: flex;
            gap: 0.5rem;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
            transition: var(--transition);
        }

        .progress-dot.completed {
            background: var(--focus);
        }

        .progress-dot.current {
            background: var(--surface);
            border: 2px solid var(--focus);
            box-shadow: 0 0 0 3px var(--focus-ring);
        }

        .progress-label {
            font-size: 0.8125rem;
            color: var(--text-muted);
        }

        .progress-count {
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Settings Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 100;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--surface);
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 24px 48px rgba(0,0,0,0.12);
            transform: translateY(20px) scale(0.95);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            padding: 1.5rem 1.5rem 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .modal-close svg {
            width: 16px;
            height: 16px;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .setting-group {
            margin-bottom: 1.25rem;
        }

        .setting-group:last-child {
            margin-bottom: 0;
        }

        .setting-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .setting-label .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .setting-label .dot.focus { background: var(--focus); }
        .setting-label .dot.break { background: var(--break); }
        .setting-label .dot.long-break { background: var(--long-break); }

        .setting-input-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .setting-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: 'DM Mono', monospace;
            font-size: 1rem;
            color: var(--text-primary);
            background: var(--bg);
            transition: var(--transition);
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--text-primary);
        }

        .setting-unit {
            font-size: 0.8125rem;
            color: var(--text-muted);
            min-width: 50px;
        }

        .setting-divider {
            height: 1px;
            background: var(--border);
            margin: 1.25rem 0;
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .setting-row-label {
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .setting-row-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.125rem;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: var(--border);
            border-radius: 100px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            left: 3px;
            top: 3px;
            background: var(--surface);
            border-radius: 50%;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .toggle input:checked + .toggle-slider {
            background: var(--text-primary);
        }

        .toggle input:checked + .toggle-slider::before {
            transform: translateX(20px);
        }

        .modal-footer {
            padding: 0 1.5rem 1.5rem;
        }

        .btn-save {
            width: 100%;
            background: var(--text-primary);
            color: var(--surface);
        }

        /* Footer */
        .footer {
            padding: 1.5rem;
            text-align: center;
            border-top: 1px solid var(--border);
            background: var(--surface);
        }

        .footer-text {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Notification Badge */
        .notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text-primary);
            color: var(--surface);
            padding: 1rem 1.5rem;
            border-radius: 100px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            opacity: 0;
            transition: var(--transition);
            z-index: 50;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <svg class="logo-icon" viewBox="0 0 32 32" fill="none">
                <!-- Concentric circles representing focus -->
                <circle cx="16" cy="16" r="14" fill="#FEF2F2" stroke="#DC2626" stroke-width="1.5"/>
                <circle cx="16" cy="16" r="9" fill="none" stroke="#DC2626" stroke-width="1.5" stroke-opacity="0.5"/>
                <circle cx="16" cy="16" r="4" fill="#DC2626"/>
            </svg>
            <span class="logo-text">Focus</span>
        </div>
        <button class="settings-btn" id="openSettings" title="Instellingen">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
            </svg>
        </button>
    </header>

    <!-- Main -->
    <main class="main">
        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="focus">Focus</button>
            <button class="mode-tab" data-mode="break">Pauze</button>
            <button class="mode-tab" data-mode="long-break">Lange pauze</button>
        </div>

        <!-- Timer Card -->
        <div class="timer-card" data-mode="focus" id="timerCard">
            <p class="timer-label" id="timerLabel">Focustijd</p>
            <p class="timer-display" id="timerDisplay">25:00</p>
            <div class="timer-controls">
                <button class="btn btn-primary" id="startBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    Start
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    Reset
                </button>
            </div>
        </div>

        <!-- Progress -->
        <div class="progress-section">
            <div class="progress-dots" id="progressDots">
                <div class="progress-dot current"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
            </div>
            <p class="progress-label">
                Sessie <span class="progress-count" id="sessionCount">1</span> van <span id="totalSessions">4</span>
            </p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p class="footer-text">Werk in blokken. Neem pauzes. Blijf scherp.</p>
    </footer>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Instellingen</h2>
                <button class="modal-close" id="closeSettings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label class="setting-label">
                        <span class="dot focus"></span>
                        Focustijd
                    </label>
                    <div class="setting-input-row">
                        <input type="number" class="setting-input" id="focusTime" value="25" min="1" max="120">
                        <span class="setting-unit">minuten</span>
                    </div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">
                        <span class="dot break"></span>
                        Korte pauze
                    </label>
                    <div class="setting-input-row">
                        <input type="number" class="setting-input" id="breakTime" value="5" min="1" max="30">
                        <span class="setting-unit">minuten</span>
                    </div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">
                        <span class="dot long-break"></span>
                        Lange pauze
                    </label>
                    <div class="setting-input-row">
                        <input type="number" class="setting-input" id="longBreakTime" value="15" min="1" max="60">
                        <span class="setting-unit">minuten</span>
                    </div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Sessies voor lange pauze</label>
                    <div class="setting-input-row">
                        <input type="number" class="setting-input" id="sessionsCount" value="4" min="2" max="10">
                        <span class="setting-unit">sessies</span>
                    </div>
                </div>
                <div class="setting-divider"></div>
                <div class="setting-row">
                    <div>
                        <p class="setting-row-label">Geluidssignaal</p>
                        <p class="setting-row-desc">Speel een geluid aan het einde</p>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="soundEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-save" id="saveSettings">Opslaan</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // State
        let settings = {
            focusTime: 25,
            breakTime: 5,
            longBreakTime: 15,
            sessionsCount: 4,
            soundEnabled: true
        };

        let state = {
            mode: 'focus',
            timeLeft: settings.focusTime * 60,
            isRunning: false,
            currentSession: 1,
            interval: null
        };

        // Elements
        const timerCard = document.getElementById('timerCard');
        const timerLabel = document.getElementById('timerLabel');
        const timerDisplay = document.getElementById('timerDisplay');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const modeTabs = document.querySelectorAll('.mode-tab');
        const progressDots = document.getElementById('progressDots');
        const sessionCount = document.getElementById('sessionCount');
        const totalSessions = document.getElementById('totalSessions');
        const settingsModal = document.getElementById('settingsModal');
        const notification = document.getElementById('notification');

        // Load settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('focusSettings');
            if (saved) {
                settings = { ...settings, ...JSON.parse(saved) };
            }
            updateSettingsUI();
            updateTimer();
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('focusSettings', JSON.stringify(settings));
        }

        // Update settings UI
        function updateSettingsUI() {
            document.getElementById('focusTime').value = settings.focusTime;
            document.getElementById('breakTime').value = settings.breakTime;
            document.getElementById('longBreakTime').value = settings.longBreakTime;
            document.getElementById('sessionsCount').value = settings.sessionsCount;
            document.getElementById('soundEnabled').checked = settings.soundEnabled;
            totalSessions.textContent = settings.sessionsCount;
            updateProgressDots();
        }

        // Update progress dots
        function updateProgressDots() {
            progressDots.innerHTML = '';
            for (let i = 1; i <= settings.sessionsCount; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (i < state.currentSession) {
                    dot.classList.add('completed');
                } else if (i === state.currentSession) {
                    dot.classList.add('current');
                }
                progressDots.appendChild(dot);
            }
        }

        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Update timer display
        function updateTimer() {
            timerDisplay.textContent = formatTime(state.timeLeft);
            
            // Update tab title with time and mode indicator
            const modeIcon = state.mode === 'focus' ? 'ðŸ”´' : state.mode === 'break' ? 'ðŸŸ¢' : 'ðŸ”µ';
            const modeText = state.mode === 'focus' ? 'Focus' : state.mode === 'break' ? 'Pauze' : 'Lange pauze';
            document.title = `${formatTime(state.timeLeft)} ${modeIcon} ${modeText}`;
        }

        // Set mode
        function setMode(mode) {
            state.mode = mode;
            state.isRunning = false;
            clearInterval(state.interval);

            // Update time based on mode
            switch (mode) {
                case 'focus':
                    state.timeLeft = settings.focusTime * 60;
                    timerLabel.textContent = 'Focustijd';
                    break;
                case 'break':
                    state.timeLeft = settings.breakTime * 60;
                    timerLabel.textContent = 'Korte pauze';
                    break;
                case 'long-break':
                    state.timeLeft = settings.longBreakTime * 60;
                    timerLabel.textContent = 'Lange pauze';
                    break;
            }

            // Update UI
            timerCard.dataset.mode = mode;
            modeTabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });
            updateTimer();
            updateStartButton();
        }

        // Update start button
        function updateStartButton() {
            if (state.isRunning) {
                startBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                    Pauze
                `;
            } else {
                startBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    Start
                `;
            }
        }

        // Request notification permission on first interaction
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // Send browser notification
        function sendBrowserNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body: body,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="%23FEF2F2" stroke="%23DC2626" stroke-width="1.5"/><circle cx="16" cy="16" r="9" fill="none" stroke="%23DC2626" stroke-width="1.5" opacity="0.5"/><circle cx="16" cy="16" r="4" fill="%23DC2626"/></svg>',
                    tag: 'focus-timer',
                    requireInteraction: true
                });

                notification.onclick = () => {
                    window.focus();
                    notification.close();
                };

                // Auto-close after 10 seconds
                setTimeout(() => notification.close(), 10000);
            }
        }

        // Start/Pause timer
        function toggleTimer() {
            // Request notification permission on first interaction
            requestNotificationPermission();
            
            if (state.isRunning) {
                clearInterval(state.interval);
                state.isRunning = false;
            } else {
                state.isRunning = true;
                state.interval = setInterval(tick, 1000);
            }
            updateStartButton();
        }

        // Timer tick
        function tick() {
            if (state.timeLeft > 0) {
                state.timeLeft--;
                updateTimer();
            } else {
                clearInterval(state.interval);
                state.isRunning = false;
                onTimerComplete();
            }
        }

        // Timer complete
        function onTimerComplete() {
            if (settings.soundEnabled) {
                playSound();
            }

            if (state.mode === 'focus') {
                // Completed a focus session
                if (state.currentSession >= settings.sessionsCount) {
                    // Time for long break
                    showNotification('ðŸŽ‰ Alle sessies voltooid! Tijd voor een lange pauze.');
                    sendBrowserNotification('Cyclus voltooid! ðŸŽ‰', 'Alle sessies afgerond. Tijd voor een lange pauze.');
                    state.currentSession = 1;
                    setMode('long-break');
                } else {
                    // Time for short break
                    showNotification('âœ“ Focussessie voltooid! Neem een korte pauze.');
                    sendBrowserNotification('Focustijd voorbij! âœ“', 'Goed gedaan! Neem nu een korte pauze.');
                    setMode('break');
                }
            } else {
                // Completed a break
                if (state.mode === 'break') {
                    state.currentSession++;
                }
                showNotification('â° Pauze voorbij! Klaar voor de volgende sessie?');
                sendBrowserNotification('Pauze voorbij! â°', 'Klaar voor de volgende focussessie?');
                setMode('focus');
            }

            sessionCount.textContent = state.currentSession;
            updateProgressDots();
            updateStartButton();
        }

        // Play notification sound
        function playSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);

            // Second beep
            setTimeout(() => {
                const osc2 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();
                osc2.connect(gain2);
                gain2.connect(audioContext.destination);
                osc2.frequency.value = 1000;
                osc2.type = 'sine';
                gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                osc2.start(audioContext.currentTime);
                osc2.stop(audioContext.currentTime + 0.5);
            }, 200);
        }

        // Show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Reset timer
        function resetTimer() {
            clearInterval(state.interval);
            state.isRunning = false;
            setMode(state.mode);
            updateStartButton();
        }

        // Event Listeners
        startBtn.addEventListener('click', toggleTimer);
        resetBtn.addEventListener('click', resetTimer);

        modeTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                if (!state.isRunning) {
                    setMode(tab.dataset.mode);
                }
            });
        });

        document.getElementById('openSettings').addEventListener('click', () => {
            settingsModal.classList.add('active');
        });

        document.getElementById('closeSettings').addEventListener('click', () => {
            settingsModal.classList.remove('active');
        });

        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                settingsModal.classList.remove('active');
            }
        });

        document.getElementById('saveSettings').addEventListener('click', () => {
            settings.focusTime = parseInt(document.getElementById('focusTime').value) || 25;
            settings.breakTime = parseInt(document.getElementById('breakTime').value) || 5;
            settings.longBreakTime = parseInt(document.getElementById('longBreakTime').value) || 15;
            settings.sessionsCount = parseInt(document.getElementById('sessionsCount').value) || 4;
            settings.soundEnabled = document.getElementById('soundEnabled').checked;

            saveSettings();
            updateSettingsUI();
            
            if (!state.isRunning) {
                setMode(state.mode);
            }

            settingsModal.classList.remove('active');
            showNotification('âœ“ Instellingen opgeslagen');
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            
            if (e.code === 'Space') {
                e.preventDefault();
                toggleTimer();
            } else if (e.code === 'KeyR') {
                resetTimer();
            }
        });

        // Initialize
        loadSettings();
        setMode('focus');
    </script>
</body>
</html>
